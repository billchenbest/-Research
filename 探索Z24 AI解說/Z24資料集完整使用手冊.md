# Z24 橋樑結構健康監測資料集完整使用手冊

## 📋 目錄

- [一、資料集概述](#一資料集概述)
- [二、資料結構與組織](#二資料結構與組織)
- [三、點位分布與通道定義](#三點位分布與通道定義)
- [四、資料格式詳解](#四資料格式詳解)
- [五、技術參數與採樣頻率](#五技術參數與採樣頻率)
- [六、FRF（頻率響應函數）計算方法](#六frf頻率響應函數計算方法)
- [七、資料分析方法](#七資料分析方法)
- [八、健康基準與損傷資料](#八健康基準與損傷資料)
- [九、實際應用範例](#九實際應用範例)
- [十、常見問題與注意事項](#十常見問題與注意事項)
- [十一、參考資料與工具](#十一參考資料與工具)

---

## 一、資料集概述

### 1.1 資料集簡介

**Z24 橋樑結構健康監測資料集**是一個完整的結構動力學測試資料集，用於結構健康監測、損傷檢測和模態分析研究。

### 1.2 主要組成部分

| 測試類型 | 縮寫 | 說明 | 資料位置 |
|---------|------|------|---------|
| **漸進損傷測試** | PDT | Progressive Damage Tests | `pdt_01-08/`, `pdt_09-17/` |
| **環境振動測試** | AVT | Ambient Vibration Tests | `pdt_XX/avt/` |
| **強迫振動測試** | FVT | Forced Vibration Tests | `pdt_XX/fvt/` |
| **環境監測系統** | EMS | Environmental Monitoring System | `Z24ems1/`, `Z24ems2/`, `Z24ems3/` |

### 1.3 資料集特點

- ✅ **多測試條件**：17個PDT測試，每個有9個設置
- ✅ **多測量點**：EMS系統覆蓋大量測量位置
- ✅ **長期監測**：包含環境監測資料，可進行長期趨勢分析
- ✅ **損傷漸進**：PDT測試模擬漸進損傷過程
- ✅ **多種激勵**：包含環境振動和強迫振動兩種激勵方式
- ✅ **完整記錄**：包含時間歷程、環境參數、測試配置等完整資訊

---

## 二、資料結構與組織

### 2.1 PDT 測試資料結構

```
pdt_01-08/
├── 01/
│   ├── avt/              # 環境振動測試
│   │   ├── 01setup01.mat
│   │   ├── 01setup02.mat
│   │   ├── ...
│   │   └── 01setup09.mat
│   └── fvt/              # 強迫振動測試
│       ├── 01setup01.mat
│       ├── 01setup02.mat
│       ├── ...
│       └── 01setup09.mat
├── 02/
│   └── ...
└── ...
```

**命名規則：**
- `XXsetupYY.mat`：XX為測試編號，YY為設置編號（01-09）
- `setup01`通常為健康基準狀態
- `setup02-09`為不同的損傷狀態或測試條件

### 2.2 EMS 環境監測資料結構

```
Z24ems1/
├── 01D00/                # 健康基準：測試01，位置D
│   ├── 01D0003.aaa
│   ├── 01D0005.aaa
│   ├── ...
│   ├── 01D00PRE.env
│   └── 01D00POS.env
├── 01D01/                # 損傷狀態1：測試01，位置D
│   ├── 01D0103.aaa
│   ├── ...
│   ├── 01D01PRE.env
│   └── 01D01POS.env
└── ...
```

**命名規則：**
- `XXYYZZ`：XX為測試編號，YY為位置（A-G），ZZ為狀態（00=健康，01-23=損傷）
- `.aaa`檔案：時間序列資料
- `PRE.env`和`POS.env`：環境監測資料

### 2.3 資料統計

| 資料類型 | 檔案數量 | 採樣頻率 | 樣本長度 | 單位 |
|---------|---------|---------|---------|------|
| **PDT測試** | 每個測試9個設置 | 100 Hz | 依檔案而定 | g（重力加速度） |
| **EMS監測** | 大量測量點 | 100 Hz | 通常65536點 | g（重力加速度） |
| **詳細測試** | 案例06和17有291-309個檔案 | 100 Hz | 65536點 | g（重力加速度） |

---

## 三、點位分布與通道定義

### 3.1 EMS加速計點位分布（根據 Fig. 37）

根據官方文件 **Fig. 37: Location and orientation of accelerometers**，Z24橋樑上共安裝了 **17個加速計**：

#### 3.1.1 橋面加速計（Plan View）

**Zurich方向（上層橋面）：**
- **通道 05**：最左側外緣
- **通道 10**：最左側內側車道
- **通道 09**：中間區域內側車道
- **通道 08**：中間區域外緣
- **通道 07**：最右側內側車道
- **通道 12**：最右側外緣

**Bern方向（下層橋面）：**
- **通道 04**：最左側外緣
- **通道 16**：最左側內側車道
- **通道 06**：最左側內側車道（略偏右）
- **通道 15**：最左側外緣（在04下方）
- **通道 13**：中間區域外緣
- **通道 11**：最右側外緣
- **通道 14**：最右側外緣（比11更右側）

#### 3.1.2 橋墩加速計（Cross View）

**中央橋墩（垂直分布）：**
- **通道 03**：橋墩上部
- **通道 02**：橋墩中部
- **通道 01**：橋墩下部（靠近基礎）

### 3.2 通道編號定義表

| 通道編號 | 位置描述 | 方向 | 備註 |
|---------|---------|------|------|
| **01** | 橋墩下部（靠近基礎） | V/T/L | 中央橋墩 |
| **02** | 橋墩中部 | V/T/L | 中央橋墩 |
| **03** | 橋墩上部 | V/T/L | 中央橋墩 |
| **04** | Bern方向，最左側外緣 | V/T/L | 橋面 |
| **05** | Zurich方向，最左側外緣 | V/T/L | 橋面 |
| **06** | Bern方向，最左側內側車道 | V/T/L | 橋面 |
| **07** | Zurich方向，最右側內側車道 | V/T/L | 橋面 |
| **08** | Zurich方向，中間區域外緣 | V/T/L | 橋面 |
| **09** | Zurich方向，中間區域內側車道 | V/T/L | 橋面 |
| **10** | Zurich方向，最左側內側車道 | V/T/L | 橋面 |
| **11** | Bern方向，最右側外緣 | V/T/L | 橋面 |
| **12** | Zurich方向，最右側外緣 | V/T/L | 橋面 |
| **13** | Bern方向，中間區域外緣 | V/T/L | 橋面 |
| **14** | Bern方向，最右側外緣（比11更右） | V/T/L | 橋面 |
| **15** | Bern方向，最左側外緣（在04下方） | V/T/L | 橋面 |
| **16** | Bern方向，最左側內側車道 | V/T/L | 橋面 |

### 3.3 檔案命名規則與通道對應

#### 3.3.1 EMS資料檔案命名規則

**格式：** `WWDHH` + **通道號碼（兩位數）** + `.AAA`

| 代碼 | 說明 | 範圍/值 |
|------|------|---------|
| `WW` | 運行週數 | 01開始的兩位數 |
| `D` | 星期幾 | A=星期一, B=星期二, ..., G=星期日 |
| `HH` | 小時 | 00-23（24小時制） |
| **通道號碼** | 對應Fig. 37中的加速計位置 | 01-16 |

**範例：**
- `13A2305.AAA` = 第13週，星期一，23時，**通道05**（Zurich方向最左側外緣）
- `01B1201.AAA` = 第1週，星期二，12時，**通道01**（橋墩下部）

#### 3.3.2 PDT測試通道命名規則

**常見通道名稱：**
- `DP2V`：可能為激振輸入通道（建議作為參考通道）
- `R1V`, `R2V`, `R3V`：參考通道（可能為參考點）
- `139V`, `239V`, `343V`：測量點通道（數字可能對應測量網格編號）
- `139T`, `239T`：橫向（Transverse）測量通道

**命名規則推測：**
- 數字部分（如 139, 239）可能對應測量網格的行號
- 字母部分（V, T, L）對應方向：
  - **V**：垂直（Vertical）
  - **T**：橫向（Transverse）
  - **L**：縱向（Longitudinal）

### 3.4 座標系統定義

#### 3.4.1 局部座標系統（Local Coordinate System）

| 軸向 | 符號 | 方向說明 |
|------|------|---------|
| **垂直** | **V** | 向上（Vertical） |
| **橫向** | **T** | 水平向左（Transverse） |
| **縱向** | **L** | 水平向右（Longitudinal） |

#### 3.4.2 地理座標系統

- **North**：指向右上（Zurich方向）
- **South**：指向左下（Bern方向）
- **Utzenstorf**：橋樑左側（西側）
- **Koppigen**：橋樑右側（東側）

### 3.5 環境監測系統通道定義

#### 3.5.1 環境參數通道（Table 11）

| 標籤 | 意義 | 檔案單位 | 轉換公式 | 實際單位 |
|------|------|---------|---------|---------|
| **WS** | 風速 | V | 5 | m/s |
| **WD** | 風向 | V | 36 | Deg（度） |
| **AT** | 環境溫度 | V | 100 × V - 40 | °C |
| **R** | 降雨（是/否） | V | True: 3V, False: 1V | -/- |
| **H** | 相對濕度 | V | 10 | % |
| **TE** | 熱膨脹 | V | 5 | mm |
| **ADU** | Utzenstorf端角位移 | V | （缺失） | Deg |
| **ADK** | Koppigen端角位移 | V | （缺失） | Deg |

> **重要注意事項**：文件中提到「包含所有EMS安裝資料的檔案遺失，且測量角位移的感測器分發器停止工作。因此橋墩頂部角位移的轉換公式缺失。」

#### 3.5.2 溫度感測器通道定義

**土壤溫度感測器：**
- **TSPU1-3**：Utzenstorf端橋墩土壤溫度，深度分別為 0.2m, 0.6m, 1.0m
- **TSAU1-3**：Utzenstorf端橋台土壤溫度，深度分別為 0.4m, 0.8m, 1.2m
- **TSPK1-3**：Koppigen端橋墩土壤溫度，深度分別為 0.2m, 0.6m, 1.0m
- **TSAK1-3**：Koppigen端橋台土壤溫度，深度分別為 0.4m, 0.8m, 1.2m

**結構溫度感測器（三個橫斷面）：**
- **TSWS1-3**：南側（Bern）人行道溫度
- **TSWN1-3**：北側（Zurich）人行道溫度
- **TWS1-3**：南側腹板溫度
- **TWC1-3**：中央腹板溫度
- **TWN1-3**：北側腹板溫度
- **TP1-3**：路面溫度
- **TDT1-3**：橋面板頂部溫度
- **TDS1-3**：橋面板底部溫度
- **TS1-3**：底板溫度

**其他溫度感測器：**
- **TBC1, TBC2**：箱室溫度（用於熱膨脹測量）
  - 位置：橋樑箱室內（見 Fig. 41）
  - 類型：RTD（電阻溫度檢測器）感測器
  - 用途：測量箱室內空氣溫度，用於熱膨脹測量
  - 注意：熱膨脹實際使用"invar"線測量，TBC感測器可能不是必需的

**溫度測量橫斷面位置（根據 Fig. 39）：**
- **Section 1**：靠近Utzenstorf端（左側）
- **Section 2**：橋樑中間區域
- **Section 3**：靠近Koppigen端（右側）

**土壤溫度測量位置（根據 Fig. 40）：**
- **AUi**：Utzenstorf端橋台，深度1, 2, 3（0.4m, 0.8m, 1.2m）
- **PUi**：Utzenstorf端橋墩，深度1, 2, 3（0.2m, 0.6m, 1.0m）
- **PKi**：Koppigen端橋墩，深度1, 2, 3（0.2m, 0.6m, 1.0m）
- **AKi**：Koppigen端橋台，深度1, 2, 3（0.4m, 0.8m, 1.2m）

---

## 四、資料格式詳解

### 4.1 `.mat` 檔案格式（Matlab格式）

**檔案位置範例：**
```
pdt_01-08/01/avt/01setup01.mat
pdt_01-08/01/fvt/01setup01.mat
```

**包含的變數：**
- `data`：時間資料矩陣
  - 每**列**（row）對應一個時間點
  - 每**行**（column）對應一個測量通道
  - 單位：g（重力加速度）
- `labelshulp`：通道資訊標籤
  - 包含每個通道的測量位置資訊
  - 通道命名規則：數字+方向代碼（V=垂直, T=橫向, L=縱向）

**技術參數：**
- 採樣頻率：**100 Hz**（fs = 1 / deltaT = 1 / 0.01 = 100 Hz，固定）
- 時間間隔：**0.01 秒**（deltaT）
- 奈奎斯特頻率：**50 Hz**（f_nyquist = fs / 2 = 100 / 2 = 50 Hz，最大可解析頻率）

### 4.2 `.aaa` 檔案格式（ASCII時間歷程資料）

**檔案位置範例：**
```
Z24ems1/01D00/01D0003.aaa
pdt_01-08/06/avt/01/100V.aaa
```

**檔案結構：**

```
行號  內容                    說明
1     100V.aaa|8Averages      檔案名稱和平均次數
2     65536                   樣本數量
3     0.010000                時間間隔（秒）
4+    加速度數值             時間序列資料（單位：g）
...   ...                     ...
結尾  元數據資訊              包含採集參數
```

**元數據包含：**
- 單位：g（重力加速度）
- 感測器靈敏度：1 V/g
- 平均次數：通常為8
- 採集時間：約82.398秒
- 前濾波增益和後濾波增益
- 統計資訊（最小值、最大值、平均值、標準差）

**重要技術規格（根據Appendix J）：**
- **樣本數量**：總是 **65536** 個樣本
- **平均方式**：8次平均，可能有或沒有不確定長度的時間間隔
- **樣本間隔**：0.01秒（對應100 Hz採樣頻率）
- **檔案格式**：ASCII格式，確保跨平台可讀性

### 4.3 `.env` 檔案格式（環境監測資料）

**檔案結構：**
- **第1行**：標籤（來自 Table 11），每行一個
- **第2-11行**：第1-10次掃描的測量值（未轉換），每行對應 Table 11 中的一個標籤

**範例：**
```
WS [V]
WD [V]
AT [V]
...
-3.121200e-04
0.000000e+00
6.351665e-01
...
```

---

## 五、技術參數與採樣頻率

### 5.1 採樣頻率說明

根據Z24資料集的實際資料：

| 參數 | 數值 | 說明 |
|------|------|------|
| **時間間隔** | deltaT = 0.01 秒 | 固定值 |
| **採樣頻率** | fs = 1 / deltaT = **100 Hz** | 資料的實際採樣頻率 |
| **奈奎斯特頻率** | f_nyquist = fs / 2 = **50 Hz** | 最大可解析頻率 |

### 5.2 重要澄清

1. **採樣頻率（Sampling Frequency）**：100 Hz
   - 這是資料的實際採樣頻率
   - 表示每秒採樣100個數據點
   - 計算方式：fs = 1 / deltaT = 1 / 0.01 = 100 Hz

2. **奈奎斯特頻率（Nyquist Frequency）**：50 Hz
   - 這是根據採樣定理確定的最大可解析頻率
   - 計算方式：f_nyquist = fs / 2 = 100 / 2 = 50 Hz
   - 根據奈奎斯特-香農採樣定理，只有頻率低於奈奎斯特頻率的信號才能被正確重建

### 5.3 驗證

從實際資料檔案驗證：
```
檔案：01D0003.aaa
行1: 01B2303.aaa
行2: 65536          (樣本數量)
行3: 0.01           (時間間隔，秒)
```

計算：
- 採樣頻率 = 1 / 0.01 = 100 Hz ✅
- 奈奎斯特頻率 = 100 / 2 = 50 Hz ✅

### 5.4 技術規格摘要

| 參數 | 數值 | 說明 |
|------|------|------|
| 採樣頻率 | 100 Hz | fs = 1 / deltaT = 1 / 0.01 = 100 Hz |
| 時間間隔 | 0.01 秒 | deltaT |
| 奈奎斯特頻率 | 50 Hz | f_nyquist = fs / 2 = 100 / 2 = 50 Hz（最大可解析頻率） |
| 樣本長度（.aaa檔案） | 通常 65536 點 | 約 655.36 秒 |
| 資料單位 | g（重力加速度） | 重力加速度單位 |
| 感測器靈敏度 | 1 V/g | 感測器靈敏度 |

---

## 六、FRF（頻率響應函數）計算方法

### 6.1 FRF概述

**頻率響應函數（Frequency Response Function, FRF）**是描述線性系統在頻域中輸入與輸出關係的函數。在結構動力學中，FRF表示結構在特定頻率下的響應特性。

### 6.2 FRF的數學定義

對於單輸入單輸出（SISO）系統：

\[
H(\omega) = \frac{Y(\omega)}{X(\omega)} = \frac{S_{XY}(\omega)}{S_{XX}(\omega)}
\]

其中：
- \(H(\omega)\)：頻率響應函數
- \(Y(\omega)\)：輸出信號的傅立葉變換
- \(X(\omega)\)：輸入信號的傅立葉變換
- \(S_{XY}(\omega)\)：輸入-輸出交叉功率譜密度
- \(S_{XX}(\omega)\)：輸入功率譜密度

### 6.3 FRF計算方法

#### 6.3.1 強迫振動測試（FVT）的FRF計算

**適用情況：** 有已知的輸入激勵信號

**基本方法：H1估計器**

\[
H_1(\omega) = \frac{S_{XY}(\omega)}{S_{XX}(\omega)}
\]

**優點：**
- 對輸出雜訊不敏感
- 適合輸入信號雜訊較小的情況

#### 6.3.2 環境振動測試（AVT）的FRF計算

**適用情況：** 只有輸出響應資料，無已知輸入

**輸出-輸出方法：功率譜密度法**

\[
H_{ij}(\omega) = \frac{S_{Y_i Y_j}(\omega)}{S_{Y_j Y_j}(\omega)}
\]

其中：
- \(Y_i\)：第i個測量點的響應
- \(Y_j\)：參考測量點的響應（通常選擇響應較大的點）

### 6.4 FRF計算實作範例（Python）

```python
import numpy as np
import scipy.io as sio
from scipy import signal
import matplotlib.pyplot as plt

def load_z24_mat_file(filepath):
    """載入Z24的.mat檔案"""
    mat_data = sio.loadmat(filepath)
    data = mat_data['data']
    labelshulp = mat_data.get('labelshulp', None)
    return data, labelshulp

def calculate_frf_from_z24(filepath, reference_channel=0, 
                           response_channel=1, fs=100, 
                           nperseg=None, window='hann'):
    """
    從Z24資料計算FRF
    
    參數:
        filepath: .mat檔案路徑
        reference_channel: 參考通道索引
        response_channel: 響應通道索引
        fs: 採樣頻率（預設100 Hz）
        nperseg: 每個段的長度
        window: 窗函數類型
    
    返回:
        frequencies: 頻率陣列
        frf: 頻率響應函數
        coherence: 相干函數
    """
    # 載入資料
    data, labelshulp = load_z24_mat_file(filepath)
    
    # 提取通道資料
    ref_signal = data[:, reference_channel]
    resp_signal = data[:, response_channel]
    
    # 設定參數
    if nperseg is None:
        nperseg = len(ref_signal) // 4
    
    # 計算功率譜密度
    frequencies, Pxy = signal.csd(
        resp_signal, ref_signal, 
        fs=fs, nperseg=nperseg, 
        window=window, noverlap=nperseg//2
    )
    
    frequencies, Prr = signal.welch(
        ref_signal, fs=fs, nperseg=nperseg,
        window=window, noverlap=nperseg//2
    )
    
    frequencies, Pyy = signal.welch(
        resp_signal, fs=fs, nperseg=nperseg,
        window=window, noverlap=nperseg//2
    )
    
    # 計算FRF
    frf = Pxy / Prr
    
    # 計算相干函數
    coherence = np.abs(Pxy)**2 / (Prr * Pyy)
    
    return frequencies, frf, coherence

# 使用範例
# 計算健康基準狀態的FRF
healthy_file = 'pdt_01-08/01/avt/01setup01.mat'
freq_healthy, frf_healthy, coh_healthy = calculate_frf_from_z24(
    healthy_file, reference_channel=0, response_channel=1
)

# 計算損傷狀態的FRF
damaged_file = 'pdt_01-08/01/avt/01setup02.mat'
freq_damaged, frf_damaged, coh_damaged = calculate_frf_from_z24(
    damaged_file, reference_channel=0, response_channel=1
)
```

### 6.5 FRF在損傷檢測中的應用

#### 6.5.1 損傷指標

**FRF幅值變化：**

\[
DI_{magnitude}(\omega) = \frac{|H_{damaged}(\omega)| - |H_{healthy}(\omega)|}{|H_{healthy}(\omega)|}
\]

**FRF相位變化：**

\[
DI_{phase}(\omega) = |\angle H_{damaged}(\omega) - \angle H_{healthy}(\omega)|
\]

#### 6.5.2 資料品質指標

**相干函數（Coherence）：**

\[
\gamma^2(\omega) = \frac{|S_{XY}(\omega)|^2}{S_{XX}(\omega) S_{YY}(\omega)}
\]

**解釋：**
- \(\gamma^2 = 1\)：完全相干，FRF可靠
- \(\gamma^2 < 0.7\)：相干性較差，FRF可能不可靠
- \(\gamma^2 < 0.5\)：相干性很差，不建議使用該頻段的FRF

---

## 七、資料分析方法

### 7.1 Z分數驅動型KNN異常檢測方法

#### 7.1.1 方法概述

結合兩種異常檢測技術：

| 方法 | 說明 | 特點 |
|------|------|------|
| **Z分數異常檢測** | 使用修正Z分數（Modified Z-score，基於MAD）識別異常點 | - 對離群值魯棒<br>- 自動計算最佳門檻值<br>- 基於統計分佈 |
| **KNN異常檢測** | 使用K最近鄰分類器進行異常檢測 | - 支援多維特徵<br>- 使用歐氏距離或餘弦相似度<br>- 支援迭代式預測 |

#### 7.1.2 從靜態擴展到動態的方法

| 靜態方法 | 動態擴展 | 說明 |
|---------|---------|------|
| **位移差異** | **頻率響應差異** | 從空間差異轉為頻率域差異 |
| **轉角差異** | **模態參數差異** | 從幾何差異轉為動力學參數差異 |
| **曲率差異** | **模態形狀差異** | 從形狀差異轉為振動模式差異 |
| **單一時刻** | **時間序列特徵** | 從單點值轉為時間序列統計特徵 |

#### 7.1.3 特徵提取流程

```
時間歷程資料
    ↓
[預處理]
    ├─ 去趨勢
    ├─ 濾波
    └─ 分段
    ↓
[特徵提取]
    ├─ 時域特徵
    │   ├─ 均值、標準差
    │   ├─ 偏度、峰度
    │   └─ RMS、峰值因子
    ├─ 頻域特徵
    │   ├─ FFT / PSD
    │   ├─ 頻率峰值
    │   └─ 頻帶能量
    └─ 模態特徵
        ├─ 自然頻率
        ├─ 阻尼比
        └─ 模態形狀
    ↓
[特徵組合]
    ├─ 多通道特徵
    ├─ 空間-頻率特徵
    └─ 時間-頻率特徵
    ↓
[差異計算]
    ├─ 健康狀態基準
    └─ 損傷狀態差異
    ↓
[Z分數 + KNN]
```

### 7.2 時域特徵提取

```python
def extract_time_domain_features(data):
    """
    提取時域統計特徵
    
    參數:
        data: 時間歷程資料
    
    返回:
        features: 特徵字典
    """
    features = {}
    
    # 基本統計量
    features['mean'] = np.mean(data)
    features['std'] = np.std(data)
    features['var'] = np.var(data)
    features['rms'] = np.sqrt(np.mean(data**2))
    
    # 峰值特徵
    features['peak'] = np.max(np.abs(data))
    features['peak_factor'] = features['peak'] / features['rms'] if features['rms'] > 0 else 0
    
    # 偏度和峰度
    from scipy import stats
    features['skewness'] = stats.skew(data)
    features['kurtosis'] = stats.kurtosis(data)
    
    return features
```

### 7.3 頻域特徵提取

```python
def extract_frequency_domain_features(data, fs=100):
    """
    提取頻域特徵
    
    參數:
        data: 時間歷程資料
        fs: 採樣頻率
    
    返回:
        features: 特徵字典
    """
    from scipy import signal
    
    # 計算功率譜密度
    frequencies, psd = signal.welch(data, fs, nperseg=len(data)//4)
    
    features = {}
    
    # 頻率峰值
    peak_idx = np.argmax(psd)
    features['dominant_freq'] = frequencies[peak_idx]
    features['peak_psd'] = psd[peak_idx]
    
    # 頻帶能量
    low_freq_mask = (frequencies >= 0) & (frequencies <= 5)
    features['low_freq_energy'] = np.trapz(psd[low_freq_mask], frequencies[low_freq_mask])
    
    mid_freq_mask = (frequencies > 5) & (frequencies <= 20)
    features['mid_freq_energy'] = np.trapz(psd[mid_freq_mask], frequencies[mid_freq_mask])
    
    high_freq_mask = (frequencies > 20) & (frequencies <= 50)
    features['high_freq_energy'] = np.trapz(psd[high_freq_mask], frequencies[high_freq_mask])
    
    return features, frequencies, psd
```

---

## 八、健康基準與損傷資料

### 8.1 健康基準資料（Baseline/Healthy State Data）

#### 8.1.1 Z24ems資料夾中的健康基準資料

在Z24ems1、Z24ems2、Z24ems3三個資料夾中，**健康基準資料以資料夾名稱結尾為"00"來標識**。

**命名規則：**
- 格式：`[測試案例編號][字母][00]`
- 範例：
  - `01D00` - 測試案例01，位置D，健康基準狀態
  - `02D00` - 測試案例02，位置D，健康基準狀態
  - `12E00` - 測試案例12，位置E，健康基準狀態

**統計資料：**
- **Z24ems1（測試案例01-05）：** 健康基準資料夾數量：**76個**
- **Z24ems2（測試案例12-17）：** 健康基準資料夾數量：約**70-80個**
- **Z24ems3（測試案例24-36）：** 健康基準資料夾數量：約**60-70個**

#### 8.1.2 PDT資料夾中的健康基準資料

在`pdt_01-08/`和`pdt_09-17/`資料夾中：

**測試案例01-05, 07-16：**
- 每個測試案例包含`avt/`和`fvt/`兩個子資料夾
- 每個子資料夾包含9個`.mat`檔案（`[編號]setup01.mat`到`[編號]setup09.mat`）
- **`setup01`通常被視為健康基準資料**

### 8.2 損傷資料（Damage State Data）

#### 8.2.1 Z24ems資料夾中的損傷資料

在Z24ems1、Z24ems2、Z24ems3三個資料夾中，**損傷資料以資料夾名稱結尾為"01-23"來標識**。

**命名規則：**
- 格式：`[測試案例編號][字母][01-23]`
- 範例：
  - `01D01` - 測試案例01，位置D，損傷狀態1
  - `01D02` - 測試案例01，位置D，損傷狀態2
  - `12E15` - 測試案例12，位置E，損傷狀態15

**統計資料：**
- **Z24ems1（測試案例01-05）：** 損傷資料夾數量：**1,741個**
- **Z24ems2（測試案例12-17）：** 損傷資料夾數量：約**1,500-1,800個**
- **Z24ems3（測試案例24-36）：** 損傷資料夾數量：約**1,200-1,500個**

### 8.3 資料對比分析

**健康基準 vs 損傷資料的比例（以Z24ems1為例）：**
- 健康基準資料夾：76個（約4.2%）
- 損傷資料夾：1,741個（約95.8%）
- **總計：1,817個資料夾**

### 8.4 資料使用建議

#### 8.4.1 識別健康基準資料

**在Z24ems資料夾中：**
- 查找所有以"00"結尾的資料夾名稱
- 例如：`*A00`, `*B00`, `*C00`, `*D00`, `*E00`, `*F00`, `*G00`

**在PDT資料夾中：**
- 測試案例01-05, 07-16的`.mat`檔案可作為健康基準
- `setup01`通常被視為健康基準狀態

#### 8.4.2 識別損傷資料

**在Z24ems資料夾中：**
- 查找所有以"01-23"結尾的資料夾名稱
- 例如：`*D01`, `*D02`, `*D15`, `*E23`等

#### 8.4.3 資料配對建議

為了進行損傷檢測分析，建議：
1. 選擇相同測試案例和位置的健康基準資料（XX00）和損傷資料（XX01-XX23）
2. 例如：
   - 健康基準：`01D00`
   - 損傷狀態：`01D01`, `01D02`, ..., `01D23`
3. 使用PRE和POS環境數據來考慮環境條件的影響

---

## 九、實際應用範例

### 9.1 範例一：讀取Z24資料並計算FRF

```python
import numpy as np
import scipy.io as sio
from scipy import signal
import matplotlib.pyplot as plt

# 1. 載入資料
mat_data = sio.loadmat('pdt_01-08/01/fvt/01setup01.mat')
data = mat_data['data']  # 時間資料矩陣
labelshulp = mat_data['labelshulp']  # 通道資訊

# 2. 查看通道標籤
print("通道標籤：", labelshulp)

# 3. 選擇參考通道和響應通道
reference_channel = 0  # 假設第一個通道是參考通道
response_channel = 1   # 假設第二個通道是響應通道

# 4. 提取通道資料
ref_signal = data[:, reference_channel]
resp_signal = data[:, response_channel]

# 5. 設定參數
fs = 100  # 採樣頻率
nperseg = len(ref_signal) // 4  # 段長度

# 6. 計算FRF
frequencies, Pxy = signal.csd(
    resp_signal, ref_signal, 
    fs=fs, nperseg=nperseg, 
    window='hann', noverlap=nperseg//2
)
frequencies, Prr = signal.welch(
    ref_signal, fs=fs, nperseg=nperseg,
    window='hann', noverlap=nperseg//2
)

# 7. 計算FRF
frf = Pxy / Prr

# 8. 計算相干函數
frequencies, Pyy = signal.welch(
    resp_signal, fs=fs, nperseg=nperseg,
    window='hann', noverlap=nperseg//2
)
coherence = np.abs(Pxy)**2 / (Prr * Pyy)

# 9. 繪製結果
fig, axes = plt.subplots(3, 1, figsize=(12, 10))

# FRF幅值
axes[0].semilogy(frequencies, np.abs(frf))
axes[0].set_xlabel('頻率 (Hz)')
axes[0].set_ylabel('FRF 幅值')
axes[0].set_title('頻率響應函數 - 幅值')
axes[0].grid(True)

# FRF相位
axes[1].plot(frequencies, np.angle(frf) * 180 / np.pi)
axes[1].set_xlabel('頻率 (Hz)')
axes[1].set_ylabel('相位 (度)')
axes[1].set_title('頻率響應函數 - 相位')
axes[1].grid(True)

# 相干函數
axes[2].plot(frequencies, coherence)
axes[2].set_xlabel('頻率 (Hz)')
axes[2].set_ylabel('相干函數')
axes[2].set_title('相干函數')
axes[2].set_ylim([0, 1])
axes[2].grid(True)

plt.tight_layout()
plt.show()
```

### 9.2 範例二：讀取EMS資料並提取特徵

```python
import numpy as np

def read_aaa_file(filename):
    """
    讀取.aaa格式的時間歷程檔案
    
    參數:
        filename: 檔案路徑
    
    返回:
        data: 加速度資料陣列
        dt: 時間間隔（秒）
        fs: 採樣頻率（Hz）
        metadata: 元數據字典
    """
    with open(filename, 'r') as f:
        lines = f.readlines()
    
    # 讀取檔案名稱和平均次數
    header = lines[0].strip()
    
    # 讀取樣本數和時間間隔
    n_samples = int(lines[1].strip())
    dt = float(lines[2].strip())
    fs = 1.0 / dt
    
    # 讀取加速度資料
    data = []
    metadata_start = False
    metadata = {}
    
    for i in range(3, len(lines)):
        line = lines[i].strip()
        
        # 檢查是否到達元數據部分
        if line.startswith('Timehistories end here'):
            metadata_start = True
            continue
        
        if not metadata_start:
            # 讀取資料
            if line:
                try:
                    data.append(float(line))
                except ValueError:
                    break
        else:
            # 解析元數據
            if ':' in line:
                parts = line.split(':', 1)
                if len(parts) == 2:
                    key = parts[0].strip()
                    value = parts[1].strip()
                    metadata[key] = value
    
    return np.array(data), dt, fs, metadata

# 使用範例
data, dt, fs, metadata = read_aaa_file('Z24ems1/01D00/01D0003.aaa')
print(f"樣本數量: {len(data)}")
print(f"採樣頻率: {fs} Hz")
print(f"時間間隔: {dt} 秒")
```

### 9.3 範例三：健康基準與損傷資料對比

```python
# 讀取健康基準資料
healthy_data, _, _ = read_aaa_file('Z24ems1/01D00/01D0003.aaa')

# 讀取損傷資料
damaged_data, _, _ = read_aaa_file('Z24ems1/01D01/01D0103.aaa')

# 提取特徵
healthy_features = extract_time_domain_features(healthy_data)
damaged_features = extract_time_domain_features(damaged_data)

# 計算差異
diff_rms = abs(damaged_features['rms'] - healthy_features['rms'])
diff_std = abs(damaged_features['std'] - healthy_features['std'])

print(f"RMS差異: {diff_rms}")
print(f"標準差差異: {diff_std}")
```

---

## 十、常見問題與注意事項

### 10.1 資料處理注意事項

| 注意事項 | 說明 | 建議 |
|---------|------|------|
| **採樣頻率** | 所有資料統一為 100 Hz | 確認資料一致性 |
| **資料長度** | 不同檔案可能有不同長度 | 統一資料長度或使用滑動視窗 |
| **多段資料** | `.aaa`檔案可能包含多個段 | 分別處理每個段或合併 |
| **通道對應** | 多通道資料需要正確對應 | 使用`labelshulp`確認通道資訊 |
| **時間同步** | 環境資料與振動資料需同步 | 檢查時間戳記 |

### 10.2 已知限制

1. **角位移轉換公式缺失**：ADU和ADK的轉換公式因資料遺失而無法使用
   - 原因：包含所有EMS安裝資料的檔案遺失
   - 原因：測量角位移的感測器分發器停止工作
   - 影響：橋墩頂部角位移的轉換公式缺失

2. **部分感測器失效**：某些標記為"xx"的感測器在EMS運行期間失效
   - 影響：相關資料未包含在分發的CD-ROM中

3. **PDT測量網格詳細定義**：完整的測量網格定義需要參考Page 120的詳細說明（未包含在提供的圖片中）

4. **Progressive Damage Tests損傷狀態詳細定義**：
   - 損傷狀態（State 1, State 2等）的詳細物理描述需要參考C11-Appendices中的相關章節
   - 例如：State 1涉及CS1（Cross Section 1）的切割和替換
   - State 2涉及CS2（Cross Section 2）的切割和替換
   - 每個狀態都有特定的結構修改步驟和功能要求

### 10.3 FRF計算參數選擇

#### 10.3.1 窗函數選擇

| 窗函數 | 優點 | 缺點 | 適用場景 |
|--------|------|------|---------|
| **Hanning** | 頻率解析度好，旁瓣抑制好 | 頻譜洩漏 | 一般用途（推薦） |
| **Hamming** | 旁瓣抑制好 | 頻率解析度稍差 | 信號較弱時 |
| **Blackman** | 旁瓣抑制最好 | 頻率解析度較差 | 強雜訊環境 |
| **矩形** | 頻率解析度最好 | 頻譜洩漏嚴重 | 不推薦 |

#### 10.3.2 段長度（nperseg）選擇

- **較長的段**：頻率解析度高，但統計穩定性差
- **較短的段**：統計穩定性好，但頻率解析度低
- **建議**：使用信號長度的1/4到1/8

#### 10.3.3 重疊率選擇

- **建議重疊率**：50%（noverlap = nperseg // 2）
- **優點**：提高統計穩定性，減少資料浪費

### 10.4 常見問題與解決方案

#### 問題1：FRF在某些頻段不可靠

**原因：**
- 相干函數過低
- 信號強度不足
- 雜訊干擾

**解決方案：**
- 檢查相干函數，只使用相干函數 > 0.7 的頻段
- 增加平均次數
- 改善信號品質

#### 問題2：FRF幅值異常

**原因：**
- 輸入信號過小（接近雜訊水平）
- 頻率解析度不足
- 窗函數選擇不當

**解決方案：**
- 檢查輸入信號的功率譜密度
- 調整段長度
- 嘗試不同的窗函數

#### 問題3：多通道資料同步問題

**原因：**
- 採樣時鐘不同步
- 資料讀取錯誤

**解決方案：**
- 確認所有通道使用相同的時間向量
- 檢查資料長度是否一致

---

## 十一、參考資料與工具

### 11.1 相關檔案位置

- **PDT測試資料**：`pdt_01-08/` 和 `pdt_09-17/`
- **EMS監測資料**：`Z24ems1/`, `Z24ems2/`, `Z24ems3/`
- **說明文件**：`readme.txt`, `Z24-EMS-readme.pdf`, `C11-Appendices.pdf`

### 11.2 自動化工具

- **FRF計算工具**：`scripts/z24_frf.py`
- **GUI工具**：`scripts/z24_gui.py`
- **一鍵執行**：`run_frf_gui.bat`

### 11.6 EMS資料採集系統硬體配置

根據 **Photo 56: EMS data acquisition rack**，EMS系統使用的硬體組件包括：

| 組件 | 型號/規格 | 說明 |
|------|---------|------|
| **ADC轉換器** | 2 × IOtech ADC 488/8SA | 8通道採樣保持類比數位轉換器，配BNC連接器面板 |
| **抗混疊濾波器** | Kemo VBF64 | 根據EMPA規格設計的抗混疊濾波器 |
| **信號路由** | Patch panel | 用於信號連接和路由的配線面板 |
| **溫度掃描器** | IOtech Tempscan 1100 + EXP 10A | 類比數位轉換器及擴展單元 |
| **加速計電源** | 專用電源供應器 | 為Kinemetrics FBA 11加速計供電 |
| **資料記錄電腦** | Olivetti M4/82 PC | 配備Iomega Jaz 1G磁碟機 |
| **不間斷電源** | APC UPS | 不間斷主電源供應系統 |

**重要說明：**
- 系統使用 **Kinemetrics FBA 11** 加速計
- 資料採集系統設計為24小時連續運行
- 所有資料以ASCII格式儲存，確保跨平台可讀性

### 11.3 常用Python函式庫

```python
import numpy as np              # 數值計算
import scipy.io as sio          # 讀取.mat檔案
from scipy import signal         # 信號處理
import matplotlib.pyplot as plt  # 繪圖
import pandas as pd              # 資料處理（可選）
```

### 11.4 相關文件

- **Z24_點位分布與通道定義.md**：完整的點位分布和通道定義
- **Z24_FRF資料詳細解說.md**：FRF計算的詳細說明
- **Z24_Dataset_Analysis.md**：資料集完整分析報告
- **Z24_資料使用指南_Z分數KNN方法.md**：Z分數KNN方法使用指南
- **Z24_健康基準與損傷資料分析報告.md**：健康基準與損傷資料分析
- **FRF_README.md**：FRF計算工具的快速使用指南

### 11.5 官方文件引用

1. **Fig. 37: Location and orientation of accelerometers**
   - 提供EMS加速計的完整位置和方向資訊

2. **Appendix I: Description of Environmental Monitoring System Distributed Data**
   - 檔案命名規則和通道編號定義

3. **Appendix J: Description of Distributed Data Formats**
   - 環境資料格式和通道定義（Table 11）

4. **Appendix K: Progressive Damage Tests Distributed Data**
   - PDT測試資料結構和測量網格定義

5. **Appendix D: Method for simulating the scenario Settlement of foundation**
   - 基礎沉降模擬方法的詳細說明
   - 包含損傷狀態（State 0, State 1, State 2等）的物理描述
   - 結構修改步驟和組件說明（如CS1, CS2等）

6. **Appendix H: Bridge instrumentation for Environmental Monitoring System**
   - EMS儀器配置的設計理念和策略
   - 感測器分布的原因和目標

7. **Appendix J: Description of Distributed Data Formats**
   - `.AAA`檔案格式的詳細技術規格
   - `.ENV`檔案格式的詳細技術規格
   - 資料儲存格式說明（ASCII格式）

---

## 附錄

### A. 資料檔案對照表

| PDT測試 | 健康基準 | 損傷狀態 | 說明 |
|---------|---------|---------|------|
| 測試01 | setup01 | setup02-09 | 第一個漸進損傷測試 |
| 測試02 | setup01 | setup02-09 | 第二個漸進損傷測試 |
| ... | ... | ... | ... |
| 測試17 | setup01 | setup02-09 | 第十七個漸進損傷測試 |

### B. 特徵對照表

| 靜態特徵 | 動態對應 | 計算方式 |
|---------|---------|---------|
| `\|vd-vh\|` | `\|RMS_d - RMS_h\|` | 時域RMS差異 |
| `\|θd-θh\|` | `\|Freq_d - Freq_h\|` | 主頻率差異 |
| `\|κd-κh\|` | `\|Modal_Freq_d - Modal_Freq_h\|` | 模態頻率差異 |

### C. 快速參考表

#### C.1 EMS通道快速查詢

| 通道 | 位置 | 方向 |
|------|------|------|
| 01-03 | 橋墩 | V/T/L |
| 04-16 | 橋面 | V/T/L |

#### C.2 檔案命名快速參考

| 檔案類型 | 命名格式 | 範例 |
|---------|---------|------|
| EMS加速度 | `WWDHH` + 通道號碼 + `.AAA` | `13A2305.AAA` |
| EMS環境 | `WWDHH` + `PRE`/`POS` + `.ENV` | `13A23PRE.ENV` |
| PDT測試 | `XXsetupYY.mat` | `01setup01.mat` |
| EMS測量點 | `XXYYZZ` + 通道號碼 + `.aaa` | `01D0003.aaa` |

### C.3 環境參數轉換公式快速參考

| 參數 | 標籤 | 轉換公式 | 單位 |
|------|------|---------|------|
| 風速 | WS | 5 × V | m/s |
| 風向 | WD | 36 × V | Deg |
| 環境溫度 | AT | 100 × V - 40 | °C |
| 相對濕度 | H | 10 × V | % |
| 熱膨脹 | TE | 5 × V | mm |
| 降雨 | R | True: 3V, False: 1V | -/- |

### C.4 EMS硬體組件快速參考

| 組件類型 | 型號 | 數量/規格 |
|---------|------|---------|
| 加速計 | Kinemetrics FBA 11 | 17個（通道01-16） |
| ADC轉換器 | IOtech ADC 488/8SA | 2個（8通道×2） |
| 抗混疊濾波器 | Kemo VBF64 | 根據EMPA規格 |
| 溫度掃描器 | IOtech Tempscan 1100 | 1個 + EXP 10A擴展 |
| 資料記錄電腦 | Olivetti M4/82 PC | 1台 + Iomega Jaz 1G |

---

**文件建立日期：** 2024年  
**資料集版本：** Z24 Bridge Benchmark Dataset  
**適用範圍：** 結構健康監測、損傷檢測、模態分析、FRF計算、異常檢測

---

## 更新記錄

- **2024年** - 初始完整使用手冊建立
- **2024年** - 整合所有零散資料文件
- **2024年** - 補充點位分布與通道定義
- **2024年** - 補充健康基準與損傷資料分析
- **2024年** - 補充官方PDF重要資訊：
  - EMS資料採集系統硬體配置詳情
  - .AAA檔案格式技術規格（Appendix J）
  - 溫度感測器詳細位置資訊（Fig. 38-41）
  - Progressive Damage Tests損傷狀態說明
  - 環境參數轉換公式完整列表